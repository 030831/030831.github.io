---
layout: post
title: "4. MVC í”„ë ˆì„ì›Œí¬ ë§Œë“¤ê¸°"
categories: Gaounuri_Spring_Study
---

[Project Code File](https://github.com/030831/Java_Project/tree/master/servlet)

> ### ğŸ“Œ ëª©ì°¨

* í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ ë„ì… - `v1`

* `View` ë¶„ë¦¬ - `v2`

* `Model` ì¶”ê°€ - `v3`

* ë‹¨ìˆœí•˜ê³  ì‹¤ìš©ì ì¸ ì»¨íŠ¸ë¡¤ëŸ¬ - `v4`

* ìœ ì—°í•œ ì»¨íŠ¸ë¡¤ëŸ¬ 1 - `v5`

* ìœ ì—°í•œ ì»¨íŠ¸ë¡¤ëŸ¬ 2 - `v5`

> #### ğŸ“Œ ê°œìš”

ì´ì „ì— `jsp` ì™€ `servlet` ë§Œìœ¼ë¡œ `MVC` íŒ¨í„´ì„ ì ìš©í•˜ì˜€ì§€ë§Œ ì—¬ì „íˆ ì¤‘ë³µì½”ë“œê°€ ë°œìƒí–ˆê³  ì—¬ëŸ¬ ë¬¸ì œì ì´ ìˆì—ˆë‹¤.

ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ `frontController` ë¥¼ ë„ì…í•¨ìœ¼ë¡œì¨ ì¤‘ë³µì½”ë“œë¥¼ ì œê±°í•œë‹¤. ë²„ì „ì€ ì´ 5ê°œê°€ ìˆë‹¤.

ë¨¼ì € `v1` ì—ì„œëŠ” êµ¬ì¡°ì ìœ¼ë¡œ í˜•íƒœë¥¼ ë§ì¶œê²ƒì´ë¯€ë¡œ ì´ì „ì— ë§Œë“¤ì–´ë‘” ì½”ë“œì— ë¹„í•´ì„œ ì½”ë“œê°€ ì¶”ê°€ë˜ê±°ë‚˜ í¬ê²Œ ë³€ê²½ë˜ëŠ” ë¶€ë¶„ì€ ì—†ë‹¤.
ì—­í• ê³¼ ì±…ì„ì„ ë¶„ë¥˜í•˜ë©´ ì¤‘ë³µëœ ì½”ë“œë¥¼ ë‹¤ë¥¸ì½”ë“œì— ì˜í–¥ì´ ì•ˆê°€ë„ë¡ ì§€ìš¸ ìˆ˜ ìˆë‹¤.

ê·¸ë‹¤ìŒìœ¼ë¡œ `v2` ë²„ì „ì—ì„œëŠ” ì¤‘ë³µì½”ë“œë¥¼ ì²˜ë¦¬í•´ì£¼ëŠ” ë·°ë¥¼ ë„ì…í•¨ìœ¼ë¡œì¨ ì¤‘ë³µì½”ë“œë¥¼ í•´ê²°í•  ê²ƒì´ë‹¤.

`v3` ë²„ì „ì—ì„œëŠ” ì§€ê¸ˆê¹Œì§€ ì‚¬ìš©í•´ì˜¨ ì„œë¸”ë¦¿ì— ëŒ€í•´ ì¢…ì†ì„±ì„ ì œê±°í•˜ê³  ë·° ì´ë¦„ì— ëŒ€í•œ ì¤‘ë³µì„ ì œê±°í•˜ë©´ì„œ ê°œì„ í•œë‹¤. ì´ë¡œ ì¸í•´ êµ¬í˜„ì½”ë“œì™€ í…ŒìŠ¤íŠ¸ì½”ë“œ ì‘ì„±ì´ ì‰¬ì›Œì§€ê³  ê²½ë¡œì˜ ë³€í™”ë‚˜ í™•ì¥ìì˜ ë³€í™”ì— ëŒ€í•´ ìœ ì—°í•˜ê²Œ ëŒ€ì²˜í•  ìˆ˜ ìˆë‹¤.

`v4` ë²„ì „ì—ì„œëŠ” í•„ìš”ì—†ëŠ” ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ë°˜í™˜í•˜ëŠ” ê³¼ì •ì„ íŒŒë¼ë¯¸í„°ë¥¼ ì´ìš©í•´ ê°„ëµí™” í•œë‹¤.

ë§ˆì§€ë§‰ìœ¼ë¡œ `v5` ë²„ì „ì—ì„œëŠ” ì–´ëí„° íŒ¨í„´ì„ ì´ìš©í•˜ì—¬ ì›í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ ë²„ì „ì„ ìœ ì—°í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„í•œë‹¤.



> #### ğŸ“Œ í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ ë„ì… - v1



ì´ë²ˆì—ëŠ” í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë„ì…í•¨ìœ¼ë¡œì¨ ì´ë¥¼ í•´ê²°í•´ë³´ì.

ë¨¼ì € ê¸°ì¡´ì˜ ì½”ë“œë¥¼ ìµœëŒ€í•œ ìœ ì§€í•˜ë©´ì„œ êµ¬ì¡°ë¥¼ ë§Œë“¤ì–´ ë³¸ë‹¤.

![image](https://github.com/030831/030831.github.io/assets/101914089/9e8c334d-669f-4269-8e96-ebde28a5eb84)

êµ¬ì¡°ëŠ” ìœ„ ì‚¬ì§„ê³¼ ê°™ë‹¤.

í´ë¼ì´ì–¸íŠ¸ê°€ `http` ìš”ì²­ì„ í•˜ë©´ **í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬** ë¼ëŠ” ê²Œì´íŠ¸ë¥¼ ê±°ì³ê°€ê³  `url` ë§¤í•‘ì •ë³´ë¥¼ ê°€ì ¸ì˜¨ë‹¤ìŒì— ì»¨íŠ¸ë¡¤ëŸ¬ì™€ `jsp` ë¥¼ í˜¸ì¶œí•œë‹¤.

```java
package hello.servlet.web.frontcontroller.v1;

public interface ControllerV1 {
    void process(HttpServletRequest request , HttpServletResponse response) throws ServletException, IOException;
}
```

ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì¸í„°í˜ì´ìŠ¤ë¡œ êµ¬í˜„í•œë‹¤. ì´ì œ ì´ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ íšŒì›ë“±ë¡ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì‚´í´ë³´ì.

```java
package hello.servlet.web.frontcontroller.v1.controller;


public class MemberFormControllerV1 implements ControllerV1 {

    @Override
    public void process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        String viewPath = "/WEB-INF/views/new-form.jsp";
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
        dispatcher.forward(request , response); // ë¦¬ë‹¤ì´ë ‰íŠ¸ê°€ ì•„ë‹˜
    }
}
```

`viewPath` ë¥¼ ì„ ì–¸í•˜ê³  `dispatcher` ë¥¼ ì‚¬ìš©í•´ì„œ `Controller` ë¥¼ í†µí•´ `jsp` íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆë„ë¡ í•œë‹¤.

```java
package hello.servlet.web.frontcontroller.v1.controller;


public class MemberSaveControllerV1 implements ControllerV1 {

    private MemberRepository memberRepository = MemberRepository.getInstance();


    @Override
    public void process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        String username = request.getParameter("username");
        int age = Integer.parseInt(request.getParameter("age")); // getParameter ì˜ ë°˜í™˜ê°’ì€ í•­ìƒ Stringì´ë‹¤.

        Member member = new Member(username , age);
        memberRepository.save(member);

        // Model ì— ë°ì´í„°ë¥¼ ë³´ê´€í•œë‹¤.
        request.setAttribute("member", member);

        String viewPath = "/WEB-INF/views/save-result.jsp";
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
        dispatcher.forward(request , response);
    }
}
```

íšŒì›ì €ì¥ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” `MemberRepository` ë¥¼ ì‹±ê¸€í†¤ìœ¼ë¡œ ê°€ì ¸ì˜¤ê³  `request` ì˜ íŒŒë¼ë¯¸í„°ë¥¼ ê°€ì ¸ì˜¨ë’¤ , `Member` ê°ì²´ë¥¼ ë§Œë“¤ê³  ì €ì¥í•œë‹¤.

ì´ì œ `viewPath` ë¥¼ ì„ ì–¸í•˜ê³  `dispatcher` ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ `jsp` íŒŒì¼ì„ í˜¸ì¶œí•œë‹¤.

```java
package hello.servlet.web.frontcontroller.v1.controller;

public class MemberListControllerV1 implements ControllerV1 {

    private MemberRepository memberRepository = MemberRepository.getInstance();

    @Override
    public void process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        List<Member> members = memberRepository.findAll();
        request.setAttribute("members", members);

        String viewPath = "/WEB-INF/views/members.jsp";
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);

        dispatcher.forward(request , response);
    }
}
```

íšŒì› ë¦¬ìŠ¤íŠ¸ ëª©ë¡ ì¡°íšŒëŠ”  `findAll` ë©”ì„œë“œë¥¼ í†µí•´ `List` ì— ë‹´ê³  `viewPath` ë¥¼ ë§Œë“¤ì–´ì¤€ë’¤ `request` ì˜ `setAttribute` ì— ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  `dispatcher` ë¥¼ í˜¸ì¶œí•œë‹¤.


ì´ì œ `frontController` ë¥¼ ì‚´í´ë³´ì.

```java
package hello.servlet.web.frontcontroller.v1;

@WebServlet(name = "frontControllerServletV1" , urlPatterns = "/front-controller/v1/*")
public class FrontControllerServletV1 extends HttpServlet {

    private Map<String , ControllerV1> controllerMap= new HashMap<>();

    public FrontControllerServletV1() {
        controllerMap.put("/front-controller/v1/members/new-form", new MemberFormControllerV1());
        controllerMap.put("/front-controller/v1/members/save", new MemberSaveControllerV1());
        controllerMap.put("/front-controller/v1/members", new MemberListControllerV1());
    }

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        String requestURI = request.getRequestURI(); // URI ì •ë³´ë¥¼ ë°›ëŠ”ë‹¤.

        ControllerV1 controller = controllerMap.get(requestURI);

        if (controller == null) {
            response.setStatus(HttpServletResponse.SC_NOT_FOUND);
            return;
        }

        controller.process(request , response);


    }
}
```

ê¸°ì¡´ì˜ `servlet,jsp` ë¥¼ í†µí•œ `MVC` íŒ¨í„´ê³¼ì˜ ì°¨ì´ì ì„ ë³¸ë‹¤ë©´ `frontController` ì—ì„œ `url` ê²½ë¡œë¥¼ ìƒì„±ìë¥¼ í†µí•´ ë¯¸ë¦¬ ì§€ì •í•´ì¤€ë‹¤. ë”°ë¼ì„œ íšŒì›ì €ì¥ , íšŒì›í¼ , íšŒì›ëª©ë¡ì¡°íšŒ êµ¬í˜„ì²´ì—ëŠ” `url` ë§í¬ë¥¼ ê°€ì§€ì§€ ì•ŠëŠ”ë‹¤.

ë˜í•œ `controllerMap` ì„ í†µí•´ì„œ í•˜ë‚˜ì˜ ê³µí†µëœ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ê±°ì³ì„œ ë¡œì§ì„ ì‹¤í–‰í•˜ë„ë¡ ë§Œë“¤ì—ˆë‹¤.

ê¸°ë³¸ì ì¸ êµ¬ì¡°ëŠ” ë§ì¶”ì—ˆìœ¼ë‚˜ ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë·°ë¡œ ì´ë™í•˜ëŠ” ë¶€ë¶„ì— ì¤‘ë³µì´ ë°œìƒí•˜ê³  ê¹”ë”í•˜ì§€ ì•Šë‹¤.

ì´ì œ êµ¬ì¡°ë¥¼ ë§ì·„ìœ¼ë‹ˆ ê°„ëµí™”ë¥¼ í•´ë³´ì.


> #### ğŸ“Œ View ë¶„ë¦¬ - v2

```java
String viewPath = "/WEB-INF/views/new-form.jsp";
RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
dispatcher.forward(request, response);
```

ì´ ë¶€ë¶„ì„ ì¤‘ë³µì´ ë°œìƒí•˜ì§€ ì•Šë„ë¡ ì²˜ë¦¬í•´ì£¼ëŠ” ë·°ë¥¼ ë§Œë“¤ì–´ë³´ì.

![image](https://github.com/030831/030831.github.io/assets/101914089/5b25d667-6eea-4540-a518-14dc25bb2e05)

êµ¬ì¡°ëŠ” ìœ„ì™€ê°™ë‹¤.

`MyView` ë¥¼ í†µí•´ ëœë”ë§ì„ í•¨ìœ¼ë¡œì¨ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ëœë”ë§ì„ í•˜ì§€ ì•Šë„ë¡ í•œë‹¤.

```java
package hello.servlet.web.frontcontroller;

public class MyView {
    private String viewPath;

    public MyView(String viewPath) {
        this.viewPath = viewPath;
    }

    public void render(HttpServletRequest request , HttpServletResponse response) throws ServletException , IOException {
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
        dispatcher.forward(request, response);
    }
}
```

`viewPath` ë¥¼ ìƒì„±ìë¡œ ë°›ê³  `render` í•¨ìˆ˜ë¥¼ ì¶”ê°€í•˜ì˜€ë‹¤.

```java
package hello.servlet.web.frontcontroller.v2;

public interface ControllerV2 {
    MyView process(HttpServletRequest request , HttpServletResponse response) throws ServletException, IOException;
}
```

`Controller` ëŠ” ì´ì œ `MyView` ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.

ì´ì œ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ë³´ì.

```java
package hello.servlet.web.frontcontroller.v2.controller;

public class MemberFormControllerV2 implements ControllerV2 {

    @Override
    public MyView process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        return new MyView("/WEB-INF/views/new-form.jsp");
    }
}
```

íšŒì› ë“±ë¡ ì»¨íŠ¸ë¡¤ëŸ¬ì— ëŒ€í•œ ì½”ë“œëŠ” ìœ„ì™€ ê°™ë‹¤.
ì½”ë“œê°€ í›¨ì”¬ ê¹”ë”í•´ì¡Œë‹¤. `MyView` ê°ì²´ë¥¼ ìƒì„±í•¨ê³¼ ë™ì‹œì— ê²½ë¡œë¥¼ ì§€ì •í•´ì£¼ê³  ë°˜í™˜í•´ì£¼ëŠ” ì—­í• ì„ í•œë‹¤.

```java
package hello.servlet.web.frontcontroller.v2.controller;

public class MemberSaveControllerV2 implements ControllerV2 {

    private MemberRepository memberRepository = MemberRepository.getInstance();


    @Override
    public MyView process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        String username = request.getParameter("username");
        int age = Integer.parseInt(request.getParameter("age")); // getParameter ì˜ ë°˜í™˜ê°’ì€ í•­ìƒ Stringì´ë‹¤.

        Member member = new Member(username , age);
        memberRepository.save(member);

        // Model ì— ë°ì´í„°ë¥¼ ë³´ê´€í•œë‹¤.
        request.setAttribute("member", member);

        return new MyView("/WEB-INF/views/save-result.jsp");
    }
}
```
íšŒì› ì €ì¥ì½”ë“œëŠ” ìœ„ì™€ ê°™ë‹¤. `request` ì—ì„œ `parameter` ë¡œ ì´ë¦„ê³¼ ë‚˜ì´ë¥¼ ë°›ì•„ì˜¤ê³  `Member` ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ì €ì¥í•œë’¤ì— `MyView` ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.

```java
package hello.servlet.web.frontcontroller.v2.controller;

public class MemberListControllerV2 implements ControllerV2 {

    private MemberRepository memberRepository = MemberRepository.getInstance();

    @Override
    public MyView process(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        List<Member> members = memberRepository.findAll();
        request.setAttribute("members", members);
        return new MyView("/WEB-INF/views/members.jsp");
    }
}
```

íšŒì› ëª©ë¡ì¡°íšŒì½”ë“œë„ ê¹”ë”í•˜ì¡Œë‹¤. `findAll` í•¨ìˆ˜ë¡œ ëª¨ë‘ ì°¾ì€ë’¤ `request` ì— ì €ì¥í•œë’¤ `MyView` ê°ì²´ë¥¼ ê²½ë¡œì™€í•¨ê»˜ ë°˜í™˜í•´ì£¼ë©´ ëì´ë‹¤.

```java
package hello.servlet.web.frontcontroller.v2;

@WebServlet(name = "frontControllerServletV2" , urlPatterns = "/front-controller/v2/*")
public class FrontControllerServletV2 extends HttpServlet {

    private Map<String , ControllerV2> controllerMap= new HashMap<>();

    public FrontControllerServletV2() {
        controllerMap.put("/front-controller/v2/members/new-form", new MemberFormControllerV2());
        controllerMap.put("/front-controller/v2/members/save", new MemberSaveControllerV2());
        controllerMap.put("/front-controller/v2/members", new MemberListControllerV2());
    }

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        String requestURI = request.getRequestURI(); // URI ì •ë³´ë¥¼ ë°›ëŠ”ë‹¤.

        ControllerV2 controller = controllerMap.get(requestURI);

        if (controller == null) {
            response.setStatus(HttpServletResponse.SC_NOT_FOUND);
            return;
        }

        MyView view = controller.process(request, response);
        view.render(request, response); // ì¶”ê°€ëœ ì½”ë“œ

    }
}
```

`frontController` ë¥¼ ë³´ì. `v1` ë²„ì „ê³¼ ë¹„êµí–ˆì„ë•Œ ìƒì„±ì ë¶€ë¶„ì€ ë³€í•¨ì´ ì—†ë‹¤.
ë‹¤ë§Œ `view.render(request , response)` **ì½”ë“œê°€ ë”± í•œì¤„ ì¶”ê°€ë˜ì—ˆë‹¤.**

ì—­í• ì„ ë¶„ë¦¬í•¨ìœ¼ë¡œì¨ ì¤‘ë³µëœ ì½”ë“œë¥¼ ë¶„ë¦¬í•˜ë‹ˆ `frontController` ì½”ë“œ í•œì¤„ì´ ì¶”ê°€ë˜ê³  íšŒì›ë“±ë¡ , íšŒì›ì €ì¥ , ëª©ë¡ì¡°íšŒ ì½”ë“œì—ì„œ ì¤‘ë³µë˜ëŠ” ì½”ë“œê°€ ì „ë¶€ ì§€ì›Œì§€ë©´ì„œ ì½”ë“œì˜ ìˆ˜ê°€ ì¤„ì—ˆë‹¤.

ì´ì œ ì¡°ê¸ˆ ë” ì—­í• ì„ ë¶„ë¦¬í•´ë³´ì.

> #### ğŸ“Œ Model ì¶”ê°€ - v3


ê°œì„ í•´ì•¼í•  ì ì„ ì°¾ì•„ë³´ì.

* ì„œë¸”ë¦¿ ì¢…ì†ì„± ì œê±°

ì»¨íŠ¸ë¡¤ëŸ¬ ì…ì¥ì—ì„œ `HttpServletRequest, HttpServletResponse` ì´ ê¼­ í•„ìš”í• ê¹Œ?
ìš”ì²­ íŒŒë¼ë¯¸í„° ì •ë³´ëŠ” ìë°”ì˜ `Map` ìœ¼ë¡œ ëŒ€ì‹  ë„˜ê¸°ë„ë¡ í•˜ë©´ ì§€ê¸ˆ êµ¬ì¡°ì—ì„œëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì„œë¸”ë¦¿ ê¸°ìˆ ì„ ëª°ë¼ë„ ë™ì‘í•  ìˆ˜ ìˆë‹¤.

ê·¸ë¦¬ê³  `request` ê°ì²´ë¥¼ `Model` ë¡œ ì‚¬ìš©í•˜ëŠ” ëŒ€ì‹ ì— ë³„ë„ì˜ `Model` ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ ë°˜í™˜í•˜ë©´ ëœë‹¤. ìš°ë¦¬ê°€ êµ¬í˜„í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ê°€ **ì„œë¸”ë¦¿ ê¸°ìˆ ì„ ì „í˜€ ì‚¬ìš©í•˜ì§€ ì•Šë„ë¡ ë³€ê²½í•´ë³´ì.**
ì´ë ‡ê²Œ í•˜ë©´ êµ¬í˜„ ì½”ë“œë„ ë§¤ìš° ë‹¨ìˆœí•´ì§€ê³ , í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±ì´ ì‰½ë‹¤.

* ë·° ì´ë¦„ ì¤‘ë³µ ì œê±°

ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì§€ì •í•˜ëŠ” ë·° ì´ë¦„ì´ ì¤‘ë³µë˜ëŠ”ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. ë§Œì•½ì— ê²½ë¡œê°€ ë°”ë€Œê±°ë‚˜ í™•ì¥ìê°€ ë°”ë€Œë©´ í•˜ë‚˜í•˜ë‚˜ ë°”ê¿”ì•¼í•  ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ ë·°ì˜ ë…¼ë¦¬ ì´ë¦„ì„ ë°˜í™˜í•˜ê³  ì‹¤ì œ ë¬¼ë¦¬ ìœ„ì¹˜ì˜ ì´ë¦„ì€ í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì²˜ë¦¬í•˜ë„ë¡ í•˜ì.

* `/WEB-INF/views/new-form.jsp` -> `new-form`
* `/WEB-INF/views/save-result.jsp` -> `save-result`
* `/WEB-INF/views/members.jsp` -> `members`

![image](https://github.com/030831/030831.github.io/assets/101914089/d67ce3b5-6e0d-4233-adf6-aa80a9598399)

êµ¬ì¡°ëŠ” ìœ„ì™€ê°™ë‹¤. `viewResolver` ê°€ ì¶”ê°€ë˜ì—ˆë‹¤.
ë˜í•œ `Controller` ì—ì„œ ì´ì œ `ModelView` ë¥¼ ë°˜í™˜í•œë‹¤.

ì§€ê¸ˆê¹Œì§€ `request.setAttribute()` ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ì €ì¥í–ˆëŠ”ë° ì„œë¸”ë¦¿ì˜ ì¢…ì†ì„±ì„ ì œê±°í•˜ê¸° ìœ„í•´ ë°ì´í„°ë¥¼ ì €ì¥í•  ë³„ë„ì˜ ê°ì²´ê°€ í•„ìš”í•˜ë‹¤. ì´ë¥¼ `ModelView` ì—ì„œ í•´ì¤„ ì˜ˆì •ì´ë‹¤.

```java
package hello.servlet.web.frontcontroller;

public class ModelView {
    private String viewName;
    private Map<String, Object> model = new HashMap<>();

    public ModelView(String viewName) {
        this.viewName = viewName;
    }

    public String getViewName() {
        return viewName;
    }

    public void setViewName(String viewName) {
        this.viewName = viewName;
    }

    public Map<String, Object> getModel() {
        return model;
    }

    public void setModel(Map<String, Object> model) {
        this.model = model;
    }
}
```

`ModelView` ì½”ë“œëŠ” ìœ„ì™€ê°™ë‹¤. `lombok` ì„ í†µí•´ì„œ `getter,setter` ë¥¼ êµ¬í˜„í•˜ì§€ ì•Šì•„ë„ ëœë‹¤. 

```java
package hello.servlet.web.frontcontroller.v3;

public interface ControllerV3 {

    ModelView process(Map<String,String> paramMap);

}
```
`Controller` ëŠ” ìœ„ì™€ê°™ë‹¤. `ModelView` ë¥¼ ë°˜í™˜í•˜ê³  íŒŒë¼ë¯¸í„°ëŠ” `Map<String,String>` ì´ë‹¤. ì´ì „ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œëŠ” `HttpServletRequest , HttpServletResponse` ë¥¼ ëª¨ë‘ ë‹´ì•˜ì§€ë§Œ ì´ì   ê·¸ëŸ´ í•„ìš”ê°€ì—†ë‹¤.

ì´ì œ íšŒì›ë“±ë¡ ,  íšŒì› ì €ì¥ , ëª©ë¡ì¡°íšŒ ì½”ë“œë¥¼ ì‚´í´ë³´ì.

```java
package hello.servlet.web.frontcontroller.v3.controller;

public class MemberFormControllerV3 implements ControllerV3 {

    @Override
    public ModelView process(Map<String, String> paramMap) {
        return new ModelView("new-form");
    }
}
```

ì´ì œ ê°ì²´ë¥¼ ë°˜í™˜í• ë•Œ ì‹¤ì œ ë¬¼ë¦¬ ì£¼ì†Œê°€ ì•„ë‹ˆë¼ **ë…¼ë¦¬ì  ì£¼ì†Œë¥¼ ë°˜í™˜í•œë‹¤.**
ë˜í•œ ë©”ì„œë“œì˜ íŒŒë¼ë¯¸í„°ì— `HttpServletRequest` ê°€ ë”ì´ìƒ ì¡´ì¬í•˜ì§€ ì•Šê³  `paramMap` ë§Œ ì¡´ì¬í•œë‹¤.

```java
package hello.servlet.web.frontcontroller.v3.controller;

public class MemberSaveControllerV3 implements ControllerV3 {

    private MemberRepository memberRepository = MemberRepository.getInstance();


    @Override
    public ModelView process(Map<String, String> paramMap) {
        String username = paramMap.get("username");
        int age = Integer.parseInt(paramMap.get("age"));

        Member member =  new Member(username , age);
        memberRepository.save(member);

        ModelView mv = new ModelView("save-result");
        mv.getModel().put("member", member);
        return mv;

    }
}
```
ì´ì „ì˜ `v2` ë²„ì „ì—ì„œëŠ” `request.setAttribute("member", member)` ì™€ ê°™ì´ ë°ì´í„°ë¥¼ ì €ì¥í–ˆì§€ë§Œ ì´ì   `ModelView` ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ì €ì¥ì„ í•œë‹¤.

ë˜í•œ ì—¬ê¸°ì„œë„ ë…¼ë¦¬ì  ì£¼ì†Œì¸ `save-result` ë¥¼ ì‚¬ìš©í•˜ê³  ìˆê³  íŒŒë¼ë¯¸í„° ì •ë³´ ë˜í•œ `httpservletRequest` ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.

```java
package hello.servlet.web.frontcontroller.v3.controller;

public class MemberListControllerV3 implements ControllerV3 {

    private MemberRepository memberRepository = MemberRepository.getInstance();

    @Override
    public ModelView process(Map<String, String> paramMap) {
        List<Member> members = memberRepository.findAll();
        ModelView mv = new ModelView("members");
        mv.getModel().put("members" , members);
        return mv;
    }
}
```

`v2` ë²„ì „ì—ì„œëŠ” `request.setAttribute("members", members);` ë¡œ íšŒì›ëª©ë¡ì„ ì €ì¥í–ˆì§€ë§Œ ì´ì œ `ModelView`ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ì €ì¥í•œë‹¤.

```java
package hello.servlet.web.frontcontroller.v3;

@WebServlet(name = "frontControllerServletV3" , urlPatterns = "/front-controller/v3/*")
public class FrontControllerServletV3 extends HttpServlet {

    private Map<String , ControllerV3> controllerMap = new HashMap<>();

    public FrontControllerServletV3() {
        controllerMap.put("/front-controller/v3/members/new-form", new MemberFormControllerV3());
        controllerMap.put("/front-controller/v3/members/save", new MemberSaveControllerV3());
        controllerMap.put("/front-controller/v3/members", new MemberListControllerV3());
    }

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        String requestURI = request.getRequestURI(); // URI ì •ë³´ë¥¼ ë°›ëŠ”ë‹¤.

        ControllerV3 controller = controllerMap.get(requestURI);

        if (controller == null) {
            response.setStatus(HttpServletResponse.SC_NOT_FOUND);
            return;
        }

        // paramMap ì„ ë„˜ê²¨ì£¼ì–´ì•¼ í•¨

        Map<String, String> paraMap = createParamMap(request);
        ModelView mv = controller.process(paraMap);

        // ë…¼ë¦¬ì  ì£¼ì†Œë¥¼ ë¬¼ë¦¬ì  ì£¼ì†Œë¡œ ë°˜í™˜í•´ì•¼í•œë‹¤.
        String viewName = mv.getViewName();

        // ì•„ë˜ ì½”ë“œë¥¼ í†µí•´ íŒŒì¼ì˜ ê²½ë¡œë‚˜ í™•ì¥ìë¥¼ ìœ ì—°í•˜ê²Œ ëŒ€ì²˜í•  ìˆ˜ ìˆë‹¤.
        MyView view = viewResolver(viewName);
        view.render(mv.getModel() , request, response); // ì¶”ê°€ëœ ì½”ë“œ

    }

    private static MyView viewResolver(String viewName) {
        // ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ”ê²ƒì€ service í´ë˜ìŠ¤ì— ì¤€ìœ„ê°€ ë§ì§€ ì•Šê¸° ë•Œë¬¸ì— ë”°ë¡œ í´ë˜ìŠ¤ë¥¼ ë½‘ì•„ ì£¼ëŠ”ê²Œ ì¢‹ë‹¤.
        return new MyView("/WEB-INF/views/" + viewName + ".jsp");
    }

    private static Map<String, String> createParamMap(HttpServletRequest request) { // ctrl+alt+M - ëŒë‹¤ì‹ ë©”ì„œë“œ ë°˜í™˜
        Map<String, String> paraMap = new HashMap<>();
        request.getParameterNames().asIterator()
            .forEachRemaining(paramName -> paraMap.put(paramName, request.getParameter(paramName)));
        // paramMap ì— request ì— ìˆëŠ” ëª¨ë“  íŒŒë¼ë¯¸í„°ë¥¼ ë„£ì–´ì¤€ë‹¤.
        return paraMap;
    }
}
```

`frontController` ì½”ë“œëŠ” ìœ„ì™€ ê°™ë‹¤. ë¨¼ì € `createParamMap` ë©”ì„œë“œë¥¼ ë³´ë©´ ëŒë‹¤ì‹ì„ í†µí•´ `paraMap` ì— `request` ì— ëŒ€í•œ ëª¨ë“  ì •ë³´ë¥¼ ë„˜ê²¨ì£¼ê³  ë°˜í™˜í•œë‹¤.

ì¦‰ ì´ë¦„ , ë‚˜ì´ ì •ë³´ì— ëŒ€í•´ì„œ ì €ì¥ì„ í•œë‹¤.

ì´í›„ `paramMap` ì„ íŒŒë¼ë¯¸í„°ë¡œ ë„£ì–´ì£¼ë©´ì„œ `ModelView` ê°ì²´ë¥¼ ë§Œë“ ë‹¤. ì´ë•Œ `ModelView` ë¥¼ í†µí•´ ë…¼ë¦¬ì  ì£¼ì†Œë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.

`viewName` ì— ë…¼ë¦¬ì  ì£¼ì†Œë¥¼ ë¨¼ì € ë‹´ê³  `viewResolver` ë©”ì„œë“œë¥¼ í†µí•´ì„œ **ë…¼ë¦¬ì  ì£¼ì†Œë¥¼ ë¬¼ë¦¬ì  ì£¼ì†Œë¡œ ë°˜í™˜í•œë‹¤.**

```java
public void render(Map<String, Object> model, HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    modelToRequestAttribute(model, request);
    RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
    dispatcher.forward(request, response);
}

private static void modelToRequestAttribute(Map<String, Object> model, HttpServletRequest request) {
    model.forEach((key,value) -> request.setAttribute(key,value));
}
```

ì´ì „ì— ì‚¬ìš©í•˜ë˜ `MyView` í´ë˜ìŠ¤ì— ë‘ê°œì˜ ë©”ì„œë“œê°€ ì¶”ê°€ë˜ì—ˆë‹¤.

ë¨¼ì € `modelToRequestAttribute` ë¥¼ ë³´ë©´ `model` ì„ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê²¨ë°›ì€ í›„ì—
ëª¨ë¸ì— ìˆëŠ” `key,value` ë¥¼ ì „ë¶€ `request.setAttribute()` ë¥¼ í†µí•´ ì €ì¥í•´ì¤€ë‹¤.
ê·¸ë¦¬ê³  `dispatcher` ë¥¼ í†µí•´ ë Œë”ë§ì„ í•´ì¤€ë‹¤.

`v2` ë²„ì „ì—ì„œëŠ” `setAttribute` ë¥¼ ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë§¤ë²ˆ í•´ì£¼ì—ˆì§€ë§Œ ì´ì   `MyView` ì—ì„œ í•œêº¼ë²ˆì— ì²˜ë¦¬í•´ì¤€ë‹¤.

**ì´ì œ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì„œë¸”ë¦¿ì— ëŒ€í•œ ì¢…ì†ì„±ì„ ì œê±°í•˜ê³  ë·° ê²½ë¡œì˜ ì¤‘ë³µì„ ì œê±°í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.**

> #### ğŸ“Œ ë‹¨ìˆœí•˜ê³  ì‹¤ìš©ì ì¸ ì»¨íŠ¸ë¡¤ëŸ¬ - v4

`v3` ë²„ì „ì—ì„œ `Controller` ì½”ë“œë¥¼ ë³´ë©´ ì¤‘ë³µì´ ë°œìƒí•œë‹¤. í•­ìƒ `ModelView` ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ë°˜í™˜í•´ì•¼ í•œë‹¤ëŠ” ì ì´ë‹¤.

êµ¬ì¡°ì ìœ¼ë¡œëŠ” ì˜ ì§œì—¬ìˆì§€ë§Œ ë§¤ë²ˆ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë§Œë“¤ë•Œë§ˆë‹¤ `ModelView` ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ë°˜í™˜í•´ì•¼í•œë‹¤ë©´ ì–´ë–¨ê¹Œ?

ì´ë²ˆì—ëŠ” ì‹¤ìš©ì„±ì„ ëŠ˜ë ¤ë³´ì.


![image](https://github.com/030831/030831.github.io/assets/101914089/ef2548e8-8c51-498e-a604-c90885ad0fc4)

ì´ì œ `Controller` ê°€ `ModelView` ë¥¼ ë°˜í™˜í•˜ì§€ ì•Šê³  `ViewName` ì„ ë°˜í™˜í•˜ê²Œ ëœë‹¤. ì½”ë“œë¥¼ ì‚´í´ë³´ì.

```java
package hello.servlet.web.frontcontroller.v4;

import java.util.Map;

public interface ControllerV4 {
    String process(Map<String, String> paramMap, Map<String, Object> model);
}
```

ë”°ë¼ì„œ `Controller` ì¸í„°í˜ì´ìŠ¤ëŠ” `ModelView` ê°ì²´ë¥¼ ë°˜í™˜í•˜ì§€ ì•Šê³  `String` ë¬¸ìì—´ì„ ë°˜í™˜í•œë‹¤. ê·¸ë¦¬ê³  `Model` ì€ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê¸´ë‹¤.

ì´ì œ íšŒì› ë“±ë¡ , íšŒì› ì €ì¥ , ëª©ë¡ ì¡°íšŒ ì½”ë“œë¥¼ êµ¬í˜„í•´ë³´ì.

```java
package hello.servlet.web.frontcontroller.v4.controller;

public class MemberFormControllerV4 implements ControllerV4 {

    @Override
    public String process(Map<String, String> paramMap, Map<String, Object> model) {
        return "new-form";
    }
}
```

íšŒì› ë“±ë¡ ì½”ë“œê°€  í›¨ì”¬ ê¹”ë”í•´ì¡Œë‹¤. ì´ì „ì—ëŠ” `ModelView` ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ë°˜í™˜ì„ í•´ì•¼í–ˆëŠ”ë° ì´ì œ **ë…¼ë¦¬ì  ì£¼ì†Œë§Œ ë°˜í™˜í•˜ë©´ ëœë‹¤.**

```java
package hello.servlet.web.frontcontroller.v4.controller;

public class MemberSaveControllerV4 implements ControllerV4 {

    private MemberRepository memberRepository = MemberRepository.getInstance();

    @Override
    public String process(Map<String, String> paramMap, Map<String, Object> model) {
        String username = paramMap.get("username");
        int age = Integer.parseInt(paramMap.get("age"));

        Member member =  new Member(username , age);
        memberRepository.save(member);

        model.put("member", member);
        return "save-result";
    }
}
```

íšŒì› ì €ì¥ ë¡œì§ì—ì„œëŠ” íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê²¨ì˜¨ `model` ì— `put` ìœ¼ë¡œ ê°’ì„ ì €ì¥ë§Œ í•´ì£¼ë©´ ëì´ë‹¤.
ë°˜í™˜ê°’ì€ ë…¼ë¦¬ì£¼ì†Œì´ë¯€ë¡œ `ModelView` ê°ì²´ë¥¼ ìƒì„±í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.

```java
package hello.servlet.web.frontcontroller.v4.controller;

public class MemberListControllerV4 implements ControllerV4 {

    private final MemberRepository memberRepository = MemberRepository.getInstance();

    @Override
    public String process(Map<String, String> paramMap, Map<String, Object> model) {
        List<Member> members = memberRepository.findAll();
        model.put("members", members);
        return "members";
    }
}
```

ëª©ë¡ ì¡°íšŒë„ ì½”ë“œê°€ ë”ìš± ê¹”ë”í•´ì¡Œë‹¤.

íŒŒë¼ë¯¸í„°ì— ì •ë³´ë¥¼ ë„£ìŒìœ¼ë¡œì¨ ë§¤ë²ˆ ê°ì²´ë¥¼ ìƒì„±í•´ì•¼í•˜ëŠ” ë³µì¡í•œ ì½”ë“œë¥¼ ë”ì´ìƒ ì“°ì§€ ì•Šì•„ë„ ëœë‹¤.

```java
package hello.servlet.web.frontcontroller.v4;

@WebServlet(name = "frontControllerServletV4" , urlPatterns = "/front-controller/v4/*")
public class FrontControllerServletV4 extends HttpServlet {

    private Map<String , ControllerV4> controllerMap = new HashMap<>();

    public FrontControllerServletV4() {
        controllerMap.put("/front-controller/v4/members/new-form", new MemberFormControllerV4());
        controllerMap.put("/front-controller/v4/members/save", new MemberSaveControllerV4());
        controllerMap.put("/front-controller/v4/members", new MemberListControllerV4());
    }

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        String requestURI = request.getRequestURI(); // URI ì •ë³´ë¥¼ ë°›ëŠ”ë‹¤.

        ControllerV4 controller = controllerMap.get(requestURI);

        if (controller == null) {
            response.setStatus(HttpServletResponse.SC_NOT_FOUND);
            return;
        }

        // paramMap ì„ ë„˜ê²¨ì£¼ì–´ì•¼ í•¨

        Map<String, String> paraMap = createParamMap(request);

        Map<String, Object> model = new HashMap<>(); // ì¶”ê°€

        String viewName = controller.process(paraMap, model);

        MyView view = viewResolver(viewName);

        view.render(model , request, response);

    }

    private static MyView viewResolver(String viewName) {
        // ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ”ê²ƒì€ service í´ë˜ìŠ¤ì— ì¤€ìœ„ê°€ ë§ì§€ ì•Šê¸° ë•Œë¬¸ì— ë”°ë¡œ í´ë˜ìŠ¤ë¥¼ ë½‘ì•„ ì£¼ëŠ”ê²Œ ì¢‹ë‹¤.
        return new MyView("/WEB-INF/views/" + viewName + ".jsp");
    }

    private static Map<String, String> createParamMap(HttpServletRequest request) { // ctrl+alt+M - ëŒë‹¤ì‹ ë©”ì„œë“œ ë°˜í™˜
        Map<String, String> paraMap = new HashMap<>();
        request.getParameterNames().asIterator()
            .forEachRemaining(paramName -> paraMap.put(paramName, request.getParameter(paramName)));
        // paramMap ì— request ì— ìˆëŠ” ëª¨ë“  íŒŒë¼ë¯¸í„°ë¥¼ ë„£ì–´ì¤€ë‹¤.
        return paraMap;
    }
}
```

`frontController` ì½”ë“œë¥¼ ì‚´í´ë³´ì. `v3` ë²„ì „ì— ë¹„í•´ ë°”ë€ì ì€ í¬ê²Œ ì—†ë‹¤.
`service` ë©”ì„œë“œ ì•ˆì—ì„œ ì§ì ‘ `model` ì„ ë§Œë“¤ì–´ ì£¼ëŠ” ì½”ë“œ í•œì¤„ë§Œ ì¶”ê°€ë˜ì—ˆë‹¤.

ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì§ì ‘ ë·°ì˜ ë…¼ë¦¬ ì£¼ì†Œë¥¼ ë°˜í™˜í•˜ë¯€ë¡œ `model` ê°ì²´ëŠ” í•œë²ˆë§Œ ìƒì„±í•´ë„ ì¶©ë¶„í•˜ë‹¤.

ì§€ê¸ˆê¹Œì§€ ë‹¨ì§€ `model` ì„ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê²¼ì„ ë¿ì¸ë° ê°ì²´ë¥¼ ì—¬ëŸ¬ë²ˆ ìƒì„±í•˜ëŠ” ì¤‘ë³µì½”ë“œë¥¼ ì§€ìš¸ ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤. ì´ë¥¼ í†µí•´ êµ¬ì¡°ì ì¸ ë³€í™”ëŠ” í¬ê²Œ ë³€í•˜ì§€ ì•Šì•˜ì§€ë§Œ ì‹¤ìš©ì„±ì´ í¬ê²Œ ì¦ê°€í•˜ì˜€ë‹¤.


> #### ğŸ“Œ ìœ ì—°í•œ ì»¨íŠ¸ë¡¤ëŸ¬1 - v5

ë§Œì•½ ì–´ë–¤ ê°œë°œìëŠ” `V3` ë²„ì „ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì‚¬ìš©í•˜ê³ ì‹¶ê³  ë‹¤ë¥¸ ê°œë°œìëŠ” `V4` ë²„ì „ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´ ì–´ë–¡í• ê¹Œ?

ì§€ê¸ˆê¹Œì§€ ê°œë°œí•œ `frontController` ëŠ” í•˜ë‚˜ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ ì¸í„°í˜ì´ìŠ¤ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

ì´ë¥¼ í•´ê²° í•˜ê¸° ìœ„í•´ì„œëŠ” **ì–´ëí„° íŒ¨í„´** ì´ í•„ìš”í•˜ë‹¤.

`110v` ì „ê¸° ì½˜ì„¼íŠ¸ì— `220v` ì œí’ˆì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ë³€í™˜ ì–´ëí„°ë¥¼ ì‚¬ìš©í•˜ë“¯ì´ ì ìš©í•´ë³´ì.

![image](https://github.com/030831/030831.github.io/assets/101914089/44972282-6137-47b1-b384-8191232da8fb)

ì´ì œ `handler` ë¼ëŠ” ê°œë…ì´ ì¶”ê°€ëœë‹¤.

`handler adapter` ëŠ” ì—¬ëŸ¬ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì €ì¥í•˜ê³  ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ì—­í• ì„ ê°€ì§„ë‹¤.
`handler` ëŠ” ì´ì „ì— ì‚¬ìš©í•œ `Controller` ì™€ ê°œë…ì´ ìœ ì‚¬í•˜ë‹¤.


```java
package hello.servlet.web.frontcontroller.v5;

public interface MyHandlerAdapter {

    boolean supports(Object handler);

    ModelView handle(HttpServletRequest request , HttpServletResponse response , Object handler) throws ServletException , IOException;

}
```

`MyHandlerAdapter` ì¸í„°í˜ì´ìŠ¤ ì½”ë“œëŠ” ìœ„ì™€ ê°™ë‹¤. `supports` ëŠ” í•¸ë“¤ëŸ¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ì§€ ì—¬ë¶€ë¥¼ íŒë‹¨í•´ì¤€ë‹¤.

`handler` ë©”ì„œë“œëŠ” `Controller` ë¥¼ ì—°ê²°í•´ì£¼ëŠ” ì—­í• ì„ í•œë‹¤.

ì´ì œ `Adapter` ë¥¼ êµ¬í˜„í•´ë³´ì.

```java
package hello.servlet.web.frontcontroller.v5.adapter;

public class ControllerV3HandlerAdapter implements MyHandlerAdapter {

    @Override
    public boolean supports(Object handler) {
        return (handler instanceof ControllerV3);
    }

    @Override
    public ModelView handle(HttpServletRequest request, HttpServletResponse response , Object handler) throws ServletException, IOException {
        ControllerV3 controller = (ControllerV3) handler;

        Map<String, String> paramMap = createParamMap(request);
        ModelView mv = controller.process(paramMap);
        return mv;
    }


    private static Map<String, String> createParamMap(HttpServletRequest request) { // ctrl+alt+M - ëŒë‹¤ì‹ ë©”ì„œë“œ ë°˜í™˜
        Map<String, String> paraMap = new HashMap<>();
        request.getParameterNames().asIterator()
            .forEachRemaining(paramName -> paraMap.put(paramName, request.getParameter(paramName)));
        // paramMap ì— request ì— ìˆëŠ” ëª¨ë“  íŒŒë¼ë¯¸í„°ë¥¼ ë„£ì–´ì¤€ë‹¤.
        return paraMap;
    }
}
```

ë¨¼ì € `supports` ë©”ì„œë“œë¥¼ êµ¬í˜„í•œ ì½”ë“œë¥¼ ë³´ë©´ `instanceof` ë¥¼ í†µí•´ ì§€ì›í•˜ëŠ”ì§€ ì—¬ë¶€ë¥¼ íŒë‹¨í•œë‹¤.
`ControllerV3HandlerAdapter` ì´ë¯€ë¡œ `V3` ë²„ì „ì¸ì§€ íŒë‹¨í•´ì£¼ëŠ” ê¸°ëŠ¥ì„ í•œë‹¤.

`handle` ë©”ì„œë“œëŠ” `handler` ë¥¼ `ControllerV3` ë¡œ ìºìŠ¤íŒ…í•œë‹¤. ê·¸ë¦¬ê³  `paramMap` ì„ í†µí•´ `reqeust` ì˜ íŒŒë¼ë¯¸í„°ë¥¼ ì €ì¥í•˜ê³  `ModelView` ë¥¼ ë°˜í™˜í•œë‹¤.

ì´ì œ `frontController` ë¥¼ ë³´ì.

```java
package hello.servlet.web.frontcontroller.v5;

@WebServlet(name = "frontControllerServletV5" , urlPatterns = "/front-controller/v5/*")
public class FrontControllerServletV5 extends HttpServlet {

    private final Map<String, Object> handlerMappingMap = new HashMap<>();
    private final List<MyHandlerAdapter> handlerAdapters = new ArrayList<>();

    public FrontControllerServletV5() {
        initHandlerMappingMap();
        initHandlerAdapters();
    }

    private void initHandlerMappingMap() {
        handlerMappingMap.put("/front-controller/v5/v3/members/new-form", new MemberFormControllerV3());
        handlerMappingMap.put("/front-controller/v5/v3/members/save", new MemberSaveControllerV3());
        handlerMappingMap.put("/front-controller/v5/v3/members", new MemberListControllerV3());

        // v4 ì¶”ê°€
        handlerMappingMap.put("/front-controller/v5/v4/members/new-form", new MemberFormControllerV4());
        handlerMappingMap.put("/front-controller/v5/v4/members/save", new MemberSaveControllerV4());
        handlerMappingMap.put("/front-controller/v5/v4/members", new MemberListControllerV4());
    }

    private void initHandlerAdapters() {
        handlerAdapters.add(new ControllerV3HandlerAdapter());
        handlerAdapters.add(new ControllerV4HandlerAdapter());
    }

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        Object handler = getHandler(request);

        if (handler == null) {
            response.setStatus(HttpServletResponse.SC_NOT_FOUND);
            return;
        }

        MyHandlerAdapter adapter = getHandlerAdapter(handler);

        ModelView mv = adapter.handle(request, response, handler);

        // ë…¼ë¦¬ì  ì£¼ì†Œë¥¼ ë¬¼ë¦¬ì  ì£¼ì†Œë¡œ ë°˜í™˜í•´ì•¼í•œë‹¤.
        String viewName = mv.getViewName();

        // ì•„ë˜ ì½”ë“œë¥¼ í†µí•´ íŒŒì¼ì˜ ê²½ë¡œë‚˜ í™•ì¥ìë¥¼ ìœ ì—°í•˜ê²Œ ëŒ€ì²˜í•  ìˆ˜ ìˆë‹¤.
        MyView view = viewResolver(viewName);
        view.render(mv.getModel() , request, response); // ì¶”ê°€ëœ ì½”ë“œ
    }

    private MyHandlerAdapter getHandlerAdapter(Object handler) {
        for (MyHandlerAdapter adapter : handlerAdapters) {
            if (adapter.supports(handler)) {
                return adapter;
            }
        }
        throw new IllegalArgumentException("handler adapter ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. handler=" + handler);
    }

    private Object getHandler(HttpServletRequest request) {
        String requestURI = request.getRequestURI(); // URI ì •ë³´ë¥¼ ë°›ëŠ”ë‹¤.
        return handlerMappingMap.get(requestURI);
    }

    private static MyView viewResolver(String viewName) {
        // ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ”ê²ƒì€ service í´ë˜ìŠ¤ì— ì¤€ìœ„ê°€ ë§ì§€ ì•Šê¸° ë•Œë¬¸ì— ë”°ë¡œ í´ë˜ìŠ¤ë¥¼ ë½‘ì•„ ì£¼ëŠ”ê²Œ ì¢‹ë‹¤.
        return new MyView("/WEB-INF/views/" + viewName + ".jsp");
    }
}
```

ìƒì„±ìì— ë‘ê°œì˜ `init` ë©”ì„œë“œê°€ ìˆë‹¤. `handlerMappingMap` ì—ê²Œ ê²½ë¡œì™€ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë„£ì–´ì¤€ë‹¤. `handlerAdapters` ì—ê²ŒëŠ” ì‚¬ìš©í•  ì»¨íŠ¸ë¡¤ëŸ¬ ì–´ëí„° ê°ì²´ë¥¼ ì €ì¥í•œë‹¤.

ì´ë¡œ ì¸í•´ì„œ `getHandlerAdapter` ë©”ì„œë“œì—ì„œëŠ” `handlerAdapters` ì— ì €ì¥ëœ ì»¨íŠ¸ë¡¤ëŸ¬ ì–´ëí„° ê°ì²´ë¥¼ ë°˜ë³µë¬¸ìœ¼ë¡œ í•˜ë‚˜í•˜ë‚˜ì”© `supports` í•˜ëŠ”ì§€ í™•ì¸í•´ì¤€ë‹¤. ê·¸ë¦¬ê³  ë§ëŠ” ì–´ëí„°ë¥¼ ë°˜í™˜í•œë‹¤.

ê·¸ë¦¬ê³  `getHandler` ë©”ì„œë“œë¥¼ í†µí•´ `Object handler` ê°ì²´ì—ê²Œ ì‚¬ìš©í•  ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë°˜í™˜í•´ì¤€ë‹¤.

ë§ˆì§€ë§‰ìœ¼ë¡œ `v4` ë²„ì „ë„ ì–´ëí„°ë¥¼ ë§Œë“¤ì–´ ë³´ì.

> #### ğŸ“Œ ìœ ì—°í•œ ì»¨íŠ¸ë¡¤ëŸ¬2 - v5

```java
package hello.servlet.web.frontcontroller.v5.adapter;

public class ControllerV4HandlerAdapter implements MyHandlerAdapter {

    @Override
    public boolean supports(Object handler) {
        return (handler instanceof ControllerV4);
    }

    @Override
    public ModelView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws ServletException, IOException {
        ControllerV4 controller = (ControllerV4) handler;

        Map<String, String> paramMap = createParamMap(request);
        HashMap<String, Object> model = new HashMap<>();

        String viewName = controller.process(paramMap, model);

        ModelView mv = new ModelView(viewName);
        mv.setModel(model);
        return mv;
    }

    private static Map<String, String> createParamMap(HttpServletRequest request) { // ctrl+alt+M - ëŒë‹¤ì‹ ë©”ì„œë“œ ë°˜í™˜
        Map<String, String> paraMap = new HashMap<>();
        request.getParameterNames().asIterator()
            .forEachRemaining(paramName -> paraMap.put(paramName, request.getParameter(paramName)));
        // paramMap ì— request ì— ìˆëŠ” ëª¨ë“  íŒŒë¼ë¯¸í„°ë¥¼ ë„£ì–´ì¤€ë‹¤.
        return paraMap;
    }
}
```

`V4` ë²„ì „ì—ì„œëŠ” ë·°ì˜ ì´ë¦„ì„ ë°˜í™˜í•œë‹¤. ë”°ë¼ì„œ `model` ê°ì²´ë¥¼ ìƒì„±í•œ ë’¤ì— ë…¼ë¦¬ì  ì£¼ì†Œë¥¼ ê°€ì ¸ì˜¤ê³  `ModelView` ì—ê²Œ `viewName` ì„ ì €ì¥í•œ ë’¤ì— ë°˜í™˜í•´ì¤€ë‹¤.

ì•ì„œ ì‚´í´ë³¸ `FrontControllerServletV4` ì½”ë“œì™€ ìœ ì‚¬í•˜ë‹¤.

> #### ğŸ“Œ ì •ë¦¬

ì§€ê¸ˆê¹Œì§€ 5ê°œì˜ ë²„ì „ì„ í†µí•´ì„œ `MVC` ëª¨ë¸ì„ ê°œì„ í•´ì™”ë‹¤.

í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë„ì…í•˜ê³  ë°˜ë³µë˜ê±°ë‚˜ ì¤‘ë³µë˜ëŠ” ì½”ë“œë¥¼ ì œê±°í•œë’¤ì— , ì–´ëí„°ë¥¼ í†µí•´ ì‹¤ìš©ì„±ì„ ì¶”ê°€í–ˆë‹¤.

ì§€ê¸ˆê¹Œì§€ ë§Œë“  `MVC` íŒ¨í„´ì€ ì‹¤ì œë¡œ `Spring MVC` íŒ¨í„´ê³¼ ìœ ì‚¬í•˜ë‹¤. ë‹¤ìŒì—ëŠ” `Spring MVC` íŒ¨í„´ì— ëŒ€í•´ ì•Œì•„ë³´ì.
