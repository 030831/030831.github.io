---
layout: post
title: "5. ìŠ¤í”„ë§ MVC - êµ¬ì¡° ì´í•´"
categories: Gaounuri_Spring_Study
---

[Project Code File](https://github.com/030831/Java_Project/tree/master/servlet)

> ### ğŸ“Œ ëª©ì°¨

* í•¸ë“¤ëŸ¬ ë§¤í•‘ê³¼ í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° - `OldController`

* í•¸ë“¤ëŸ¬ ë§¤í•‘ê³¼ í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° - `HttpRequestHandler`

* ìŠ¤í”„ë§ `MVC` - ì‹œì‘í•˜ê¸°

* ìŠ¤í”„ë§ `MVC` - ì»¨íŠ¸ë¡¤ëŸ¬ í†µí•©

* ìŠ¤í”„ë§ `MVC` - ì‹¤ìš©ì ì¸ ë°©ì‹

> #### ğŸ“Œ ê°œìš”

![image](https://github.com/030831/030831.github.io/assets/101914089/9ec5c298-4822-49d3-b29a-99a716248878)

ì´ì „ ê¸€ì—ì„œëŠ” ìœ„ì™€ê°™ì€ `MVC` í”„ë ˆì„ì›Œí¬ë¥¼ ì§ì ‘ ë§Œë“¤ì—ˆë‹¤.

![image](https://github.com/030831/030831.github.io/assets/101914089/8b548119-29f6-4c97-99fb-1a98aaa8a86f)

ì‹¤ì œ `Spring` ì˜ `MVC` ëª¨ë¸ì€ ìœ„ì™€ ê°™ë‹¤.
ì‚¬ì‹¤ êµ¬ì¡°ì ì¸ í˜•íƒœëŠ” ë˜‘ê°™ë‹¤. ë‹¤ë§Œ ì´ë¦„ì´ ëª‡ê°€ì§€ ë³€ê²½ë˜ì—ˆë‹¤.

* `FrontController` -> `DispatcherServlet`
* `handlerMappingMap` -> `HandlerMapping`
* `MyHandlerAdapter` -> `HandlerAdapter`
* `ModelView` -> `ModelAndView`
* `viewResolver` -> `ViewResolver`
* `MyView` -> `View`

ì´ë¯¸ ì´ì „ì— ë§Œë“  `MVC` ì™€ êµ¬ì¡°ì ìœ¼ë¡œ ë™ì¼í•˜ê¸° ë•Œë¬¸ì— ê¸°ì¡´ì˜ ì½”ë“œë¥¼ ê±°ì˜ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë˜ , `Spring` ì˜ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ë³´ì.


> #### ğŸ“Œ í•¸ë“¤ëŸ¬ ë§¤í•‘ê³¼ í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° - OldController

```java
public interface Controller {

	ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) throws Exception;

}
```

ê³¼ê±° ë²„ì „ì˜ ìŠ¤í”„ë§ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ìœ„ì™€ ê°™ì´ ë˜ì–´ìˆì—ˆë‹¤.
ë¨¼ì € ì´ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•´ë³´ì.

```java
package hello.servlet.web.springmvc.old;

@Component("/springmvc/old-controller")
public class OldController implements Controller {

    @Override
    public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) throws Exception {
        System.out.println("OldController.handleRequest");
        return new ModelAndView("new-form");
    }
}
```

`@Component` ë¥¼ í†µí•´ ê²½ë¡œì˜ ì´ë¦„ìœ¼ë¡œ ìŠ¤í”„ë§ ë¹ˆì„ ë“±ë¡í•˜ì˜€ë‹¤. ì´ì œ ë¹ˆì˜ ì´ë¦„ìœ¼ë¡œ `URL` ì„ ë§¤í•‘í•  ê²ƒì´ë‹¤.

ë˜í•œ ë…¼ë¦¬ ì£¼ì†Œë¥¼ ë°˜í™˜í•˜ì˜€ë‹¤.

```java
spring.mvc.view.prefix=/WEB-INF/views/
spring.mvc.view.suffix=.jsp
```

ë¬¼ë¦¬ì  ì£¼ì†Œë¥¼ ì¶”ê°€í•˜ê¸° ìœ„í•´ì„œëŠ” `application.properties` ê²½ë¡œì— ìœ„ ì½”ë“œë¥¼ ì¶”ê°€í•˜ë©´ ëœë‹¤.
ì¦‰ `ViewResolver` ì—­í• ì„ í•œë‹¤.

ì»¨íŠ¸ë¡¤ëŸ¬ê°€ í˜¸ì¶œë˜ê¸° ìœ„í•´ì„œëŠ” ë‘ê°€ì§€ ì •ë³´ê°€ í•„ìš”í•˜ë‹¤.

* `HandlerMapping` (í•¸ë“¤ëŸ¬ ë§¤í•‘)
í•¸ë“¤ëŸ¬ ë§¤í•‘ì—ì„œ ì´ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì°¾ì„ ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.
ì˜ˆ) ìŠ¤í”„ë§ ë¹ˆì˜ ì´ë¦„ìœ¼ë¡œ í•¸ë“¤ëŸ¬ë¥¼ ì°¾ì„ ìˆ˜ ìˆëŠ” í•¸ë“¤ëŸ¬ ë§¤í•‘ì´ í•„ìš”í•˜ë‹¤.

* `HandlerAdapter` (í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°)
í•¸ë“¤ëŸ¬ ë§¤í•‘ì„ í†µí•´ì„œ ì°¾ì€ í•¸ë“¤ëŸ¬ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ê°€ í•„ìš”í•˜ë‹¤.
ì˜ˆ) `Controller` ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°ë¥¼ ì°¾ê³  ì‹¤í–‰í•´ì•¼ í•œë‹¤.

ê°„ë‹¨í•œ ì˜ˆì‹œë¥¼ ë“¤ìë©´ ë‚´ê°€ ê³ ê° `Client` ì¼ë•Œ ë ˆìŠ¤í† ë‘ ë§¤ë‹ˆì € `DispatcherServlet` ì—ê²Œ ì£¼ë¬¸ì„ ìš”ì²­í•œë‹¤. ë§Œì•½ ê³ ê¸°ì™€ ê´€ë ¨ëœ ìŒì‹ì„ ì£¼ë¬¸í•˜ë©´ ë§¤ë‹ˆì €ëŠ” ê³ ê¸°ë¥¼ ë‹´ë‹¹í•˜ëŠ” ì£¼ë°©ì— ê°€ì„œ `Handler Mapping` ì„ ì‹œë„í•œë‹¤.

ê·¸ë¦¬ê³  í•´ë‹¹ ìš”ë¦¬ë¥¼ ì¡°ë¦¬í• ì¤„ ì•„ëŠ” ìš”ë¦¬ì‚¬ê°€ ì§ì ‘ ìš”ë¦¬í•˜ëŠ” ê²ƒì„ `Handler Adapter` ë¼ê³  í•œë‹¤.

<br>

ìŠ¤í”„ë§ì´ ìë™ìœ¼ë¡œ ë“±ë¡í•˜ëŠ” í•¸ë“¤ëŸ¬ ë§¤í•‘ê³¼ í•¸ë“¤ëŸ¬ ì–´ëí„°ëŠ” ì—¬ëŸ¬ ì¢…ë¥˜ê°€ ìˆë‹¤.

* `HandlerMapping`

0 = `RequestMappingHandlerMapping` : ì• ë…¸í…Œì´ì…˜ ê¸°ë°˜ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ì¸ `@RequestMapping` ì—ì„œ
ì‚¬ìš©
<br>
1 = `BeanNameUrlHandlerMapping` : ìŠ¤í”„ë§ ë¹ˆì˜ ì´ë¦„ìœ¼ë¡œ í•¸ë“¤ëŸ¬ë¥¼ ì°¾ëŠ”ë‹¤.

* `HandlerAdapter`

0 = `RequestMappingHandlerAdapter` : ì• ë…¸í…Œì´ì…˜ ê¸°ë°˜ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ì¸ `@RequestMapping` ì—ì„œ
ì‚¬ìš©
<br>
1 = `HttpRequestHandlerAdapter` : `HttpRequestHandler` ì²˜ë¦¬
<br>
2 = `impleControllerHandlerAdapter` : `Controller` ì¸í„°í˜ì´ìŠ¤(ì• ë…¸í…Œì´ì…˜X, ê³¼ê±°ì— ì‚¬ìš©) 
ì²˜ë¦¬

ìˆ«ìê°€ ë‚®ì„ìˆ˜ë¡ ìš°ì„ ìˆœìœ„ê°€ ë†’ë‹¤.
ì•„ê¹Œ êµ¬í˜„í•œ `OldController` ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ `HandlerMapping` ì€ `BeanNameUrlHandlerMapping` ì„ ì‚¬ìš©í•˜ê³  `HandlerAdapter` ì€ `impleControllerHandlerAdapter` ì„ ì‚¬ìš©í•˜ê²Œ ëœë‹¤.


> #### ğŸ“Œ í•¸ë“¤ëŸ¬ ë§¤í•‘ê³¼ í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„° - HttpRequestHandler

ì´ë²ˆì—ëŠ” ì„œë¸”ë¦¿ê³¼ ìœ ì‚¬í•œ í˜•íƒœì¸ `HttpRequestHandler` ë¥¼ ì‚¬ìš©í•´ë³´ì.

```java
public interface HttpRequestHandler {

	void handleRequest(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException;

}
```
ì‹¤ì œ ì½”ë“œëŠ” ìœ„ì™€ ê°™ë‹¤. íŠ¹ì´í•œ ì ì€ `void` ë¥¼ ë°˜í™˜í•œë‹¤.

```java
package hello.servlet.web.springmvc.old;

@Component("/springmvc/request-handler")
public class MyHttpRequestHandler implements HttpRequestHandler {

    @Override
    public void handleRequest(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        System.out.println("MyHttpRequestHandler.handleRequest");
    }
}
```
ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•˜ë©´ ìœ„ ì½”ë“œì™€ ê°™ë‹¤.

`HandlerMapping` ì€ `BeanNameUrlHandlerMapping` ì„ ì‚¬ìš©í•˜ê³  
`HandlerAdapter` ì€ `HttpRequestHandlerAdapter` ì„ ì‚¬ìš©í•˜ê²Œ ëœë‹¤.

> #### ğŸ“Œ ìŠ¤í”„ë§ MVC - ì‹œì‘í•˜ê¸°

ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì• ë…¸í…Œì´ì…˜ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•´ì„œ ì•„ì£¼ ì‹¤ìš©ì ì´ê³  ìœ ì—°í•˜ë‹¤.

ì£¼ë¡œ `@RequestMapping` ì„ ì‚¬ìš©í•˜ê³  í•¸ë“¤ëŸ¬ ë§¤í•‘ê³¼ í•¸ë“¤ëŸ¬ ì–´ëí„°ëŠ” ê°ê° `RequestMappingHandlerMapping , RequestMappingHandlerAdapter` ì´ë‹¤.

ì´ì „ì— êµ¬í˜„í•œ íšŒì›ì €ì¥ , íšŒì›ë“±ë¡ , ëª©ë¡ì¡°íšŒ ë¡œì§ì„ ìŠ¤í”„ë§ ì• ë…¸í…Œì´ì…˜ì„ í†µí•´ êµ¬í˜„í•´ë³´ì.

```java
package hello.servlet.web.springmvc.v1;

@Controller
public class SpringMemberFromControllerV1 {

    @RequestMapping("/springmvc/v1/members/new-form")
    public ModelAndView process() {
        return new ModelAndView("new-form");
    }
}
```

íšŒì›ë“±ë¡ í¼ ì½”ë“œëŠ” ìœ„ì™€ê°™ì´ ì‘ì„±í•  ìˆ˜ ìˆë‹¤. `@Controller` ë¥¼ í†µí•´ ìë™ìœ¼ë¡œ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•œë‹¤. ê·¸ë¦¬ê³  `ReqeustMapping` ì„ í†µí•´ì„œ í•¸ë“¤ëŸ¬ ë§¤í•‘ê³¼ í•¸ë“¤ëŸ¬ ì–´ëí„°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```java
package hello.servlet.web.springmvc.v1;

@Controller
public class SpringMemberSaveControllerV1 {
    private MemberRepository memberRepository = MemberRepository.getInstance();

    @RequestMapping("/springmvc/v1/members/save")
    public ModelAndView process(HttpServletRequest request , HttpServletResponse response) {
        String username = request.getParameter("username");
        int age = Integer.parseInt(request.getParameter("age"));

        Member member =  new Member(username , age);
        memberRepository.save(member);

        ModelAndView mv = new ModelAndView("save-result");
        mv.addObject("member", member);
        return mv;

    }
}
```

íšŒì› ì €ì¥ ë¡œì§ì€ í¬ê²Œ ë³€í•œì ì´ ì—†ë‹¤. ë‹¤ë§Œ ë°˜í™˜ íƒ€ì…ì´ `ModelAndView` ì´ê³  `addObject` ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ìˆë‹¤.

```java
package hello.servlet.web.springmvc.v1;

@Controller
public class SpringMemberListControllerV1 {
    private MemberRepository memberRepository = MemberRepository.getInstance();

    @RequestMapping("/springmvc/v1/members")
    public ModelAndView process() {
        List<Member> members = memberRepository.findAll();
        ModelAndView mv = new ModelAndView("members");
        mv.addObject("members", members);
        return mv;
    }
}
```

íšŒì›ëª©ë¡ ì¡°íšŒ ì½”ë“œë„ ì´ì „ì— ë§Œë“  `MVC` ëª¨ë¸ì— ë¹„í•´ í¬ê²Œ ë‹¬ë¼ì§„ì ì€ì—†ë‹¤.

> #### ğŸ“Œ ìŠ¤í”„ë§ MVC - ì»¨íŠ¸ë¡¤ëŸ¬ í†µí•©

`RequestMapping` ì„ í†µí•´ ì»¨íŠ¸ë¡¤ëŸ¬ í´ë˜ìŠ¤ë¥¼ í•˜ë‚˜ì˜ íŒŒì¼ë¡œ í•©ì¹  ìˆ˜ ìˆë‹¤.

```java
package hello.servlet.web.springmvc.v2;

@Controller
@RequestMapping("springmvc/v2/members")
public class SpringMemberControllerV2 {

    private MemberRepository memberRepository = MemberRepository.getInstance();


    @RequestMapping("/new-form")
    public ModelAndView newFrom() {
        return new ModelAndView("new-form");
    }
    @RequestMapping
    public ModelAndView members() {
        List<Member> members = memberRepository.findAll();
        ModelAndView mv = new ModelAndView("members");
        mv.addObject("members", members);
        return mv;
    }

    @RequestMapping("/save")
    public ModelAndView save(HttpServletRequest request , HttpServletResponse response) {
        String username = request.getParameter("username");
        int age = Integer.parseInt(request.getParameter("age"));

        Member member =  new Member(username , age);
        memberRepository.save(member);

        ModelAndView mv = new ModelAndView("save-result");
        mv.addObject("member", member);
        return mv;

    }
}
```
ì´ë ‡ê²Œ í•˜ë©´ **ì¤‘ë³µëœ ê²½ë¡œë¥¼ ì œê±°í•  ìˆ˜ ìˆë‹¤.**
í´ë˜ìŠ¤ ë ˆë²¨ì—ì„œ `@RequestMapping` ì— ê²½ë¡œë¥¼ ì¶”ê°€í•˜ë©´ ë©”ì„œë“œì—ì„œ ì‚¬ìš©í•˜ëŠ” ê²½ë¡œê°€ ì¶”ê°€ë˜ì„œ ì¤‘ë³µëœ ê²½ë¡œë¥¼ ì‚¬ìš©í•  í•„ìš”ê°€ì—†ë‹¤.

ì§€ê¸ˆê¹Œì§€ ë³´ë©´ ì´ì „ì— êµ¬í˜„í•œ `MVC` ëª¨ë¸ì˜ `v3` ë²„ì „ í˜•íƒœì™€ ìœ ì‚¬í•˜ë‹¤. ë”°ë¼ì„œ `v3` ë²„ì „ì˜ ë¬¸ì œì ë„ ê·¸ëŒ€ë¡œ ìƒê¸´ë‹¤.

ì¦‰ ë§¤ë²ˆ `ModelAndView` ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ë°˜í™˜í•œë‹¤.

`Spring` ì—ì„œëŠ” ì´ëŸ¬í•œ ë¬¸ì œì ì„ í•´ê²°í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ì¡´ì¬í•œë‹¤. ì•Œì•„ë³´ì.

> #### ğŸ“Œ ìŠ¤í”„ë§ MVC - ì‹¤ìš©ì ì¸ ë°©ì‹

```java
package hello.servlet.web.springmvc.v3;

@Controller
@RequestMapping("springmvc/v3/members")
public class SpringMemberControllerV3 {

    private MemberRepository memberRepository = MemberRepository.getInstance();

//    @RequestMapping(value = "/new-form" , method = RequestMethod.GET)
    @GetMapping("/new-form")
    public String newFrom() {
        return "new-form";
    }

//    @RequestMapping(method = RequestMethod.GET)
    @GetMapping
    public String members(Model model) {
        List<Member> members = memberRepository.findAll();
        model.addAttribute("members", members);
        return "members";
    }

//    @RequestMapping(value = "/save" , method = RequestMethod.POST)
    @PostMapping("/save")
    public String save(@RequestParam("username") String username,
        @RequestParam("age") int age, Model model) {

        Member member = new Member(username, age);
        memberRepository.save(member);

        model.addAttribute("member", member);
        return "save-result";
    }
}
```

`v4` ë²„ì „ì—ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” `Model` ê°ì²´ë¥¼ ë°˜í™˜í•˜ì§€ ì•Šê³  `String` í˜•ì‹ì˜ ë…¼ë¦¬ ì£¼ì†Œë§Œ ë°˜í™˜í•˜ì˜€ë‹¤. `Spring` ì—ì„œë„ ë˜‘ê°™ì´ ì ìš©ì´ ê°€ëŠ¥í•˜ë‹¤.

```java
@Override
public String process(Map<String, String> paramMap, Map<String, Object> model) {
    String username = paramMap.get("username");
    int age = Integer.parseInt(paramMap.get("age"));

    Member member =  new Member(username , age);
    memberRepository.save(member);

    model.put("member", member);
    return "save-result";
}
```

ì´ì „ì— êµ¬í˜„í•œ `v4` ë²„ì „ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œëŠ” `Map<String, String> paramMap, Map<String, Object> model` íŒŒë¼ë¯¸í„°ë¥¼ ë°›ì•˜ë‹¤.

í•˜ì§€ë§Œ `Spring` ì—ì„œëŠ” `@RequestParam("username") String username,
        @RequestParam("age") int age, Model model` ì²˜ëŸ¼ ì• ë…¸í…Œì´ì…˜ì„ í†µí•´ íŒŒë¼ë¯¸í„°ë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆê³  `Model` ê°ì²´ë˜í•œ ë°›ì„ ìˆ˜ ìˆë‹¤.
        
`model` ê°ì²´ì— ë°ì´í„°ë¥¼ ì €ì¥í•˜ê¸´ ìœ„í•´ì„  `addAttribute` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´ëœë‹¤.

ë˜í•œ `@RequestMapping` ë¥¼ í†µí•´ ê²½ë¡œë¥¼ ì§€ì •í•´ì£¼ì—ˆëŠ”ë° , ë§Œì•½ `GET , POST` ê°™ì€ ìƒíƒœì½”ë“œë¥¼ ì§€ì •í•˜ê³  ì‹¶ë‹¤ë©´ `@RequestMapping(value = "/new-form" , method = RequestMethod.GET)` ì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

`@GetMapping("/new-form") , @GetMapping("/new-form")` ê°™ì€ ì• ë…¸í…Œì´ì…˜ì„ í†µí•´ ë” ê°„ë‹¨í•˜ê²Œ ì ì„ ìˆ˜ ìˆë‹¤.

ì‹¤ì œë¡œ `@GetMapping` ì• ë…¸í…Œì´ì…˜ì— ì§ì ‘ êµ¬í˜„ëœ ì½”ë“œë¥¼ ë³´ë©´ `@RequestMapping(method = RequestMethod.GET)` ì• ë…¸í…Œì´ì…˜ì´ ë“±ë¡ë˜ì–´ ìˆë‹¤.

> #### ğŸ“Œ ì •ë¦¬

ì§€ê¸ˆê¹Œì§€ ì´ì „ì— ë§Œë“  `MVC` ëª¨ë¸ì„ ì½”ë“œ ë¡œì§ì€ ê±°ì˜ ë³€ê²½í•˜ì§€ ì•Šê³  `Spring MVC` í˜•íƒœë¡œ ë°”ê¾¸ì—ˆë‹¤.

ì²˜ìŒì—ëŠ” êµ¬ë²„ì „ì˜ ì¸í„°í˜ì´ìŠ¤ í˜•ì‹ì˜ í•¸ë“¤ëŸ¬ ë§¤í•‘ , í•¸ë“¤ëŸ¬ ì–´ëí„°ë¥¼ ì‚¬ìš©í•´ë³´ì•˜ê³  
ìš”ì¦˜ ê°€ì¥ ë§ì´ ì“°ëŠ” ì• ë…¸í…Œì´ì…˜ í˜•ì‹ì„ ì‚¬ìš©í•´ë³´ì•˜ë‹¤.

ì—­ì‹œ ìœ ì—°ì„±ì´ ì¢‹ì€ `Spring` ë‹µê²Œ ì• ë…¸í…Œì´ì…˜ì„ í†µí•´ `v4` ë²„ì „ì˜ ìœ ìš©ì„±ì„ ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆì—ˆê³  ì‹¬ì§€ì–´ íŒŒë¼ë¯¸í„°ì—ë„ ì• ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ì‰½ê²Œ ì–»ì–´ì˜¬ ìˆ˜ ìˆì—ˆë‹¤.
