---
layout: post
title: "7. μ¤ν”„λ§ Http μ”μ²­"
categories: Gaounuri_Spring_Study
---

[Project Code File](https://github.com/030831/Java_Project/tree/master/springmvc)

> ### π“ λ©μ°¨

* μ”μ²­ λ§¤ν•‘
* μ”μ²­ λ§¤ν•‘ - `API`
* `HTTP` μ”μ²­ - κΈ°λ³Έ, ν—¤λ” μ΅°ν
* `HTTP` μ”μ²­ νλΌλ―Έν„° - μΏΌλ¦¬ νλΌλ―Έν„°, `HTML Form`
* `HTTP` μ”μ²­ νλΌλ―Έν„° - `@ModelAttribute`
* `HTTP` μ”μ²­ λ©”μ‹μ§€ - λ‹¨μ ν…μ¤νΈ
* `HTTP` μ”μ²­ λ©”μ‹μ§€ - `JSON`


> #### π“ μ”μ²­ λ§¤ν•‘

μ΄λ²μ—λ” μ—λ…Έν…μ΄μ…μ„ ν†µν•΄ μ–΄λ–»κ² `RequestMapping` κ²½λ΅λ¥Ό μ§€μ •ν•κ³  λ§¤ν•‘μ„ ν•λ”μ§€ μ•μ•„λ³΄μ.

```java
package hello.springmvc.basic.requestmapping;

@RestController
public class MappingController {

    private Logger log = LoggerFactory.getLogger(MappingController.class);

    @RequestMapping("/hello-basic")
    public String helloBasic() {
        log.info("helloBasic");
        return "ok";
    }
```

κΈ°λ³Έμ μΈ μ½”λ“λ” μ„μ™€ κ°™λ‹¤.

`@RequestMapping(value = {"/hello-basic", "hello-go"}, method = RequestMethod.GET)` μ²λΌ κ²½λ΅λ¥Ό μ—¬λ¬κ° μ§€μ •ν•κ±°λ‚ `HTTP` μƒνƒ μ½”λ“λ¥Ό μ§€μ •ν•  μ μλ‹¤.

`@RestController` λ¥Ό μ‚¬μ©ν•λ©΄ λ°ν™κ°’μ„ `HTTP` λ©”μ‹μ§€ λ°”λ””μ— μ…λ ¥λλ‹¤.

```java
@GetMapping(value = "/mapping-get-v2")
public String mappingGetV2() {
    log.info("mapping-get-v2");
    return "ok";
}
```

μƒνƒμ½”λ“λ¥Ό λ”°λ΅ μ…λ ¥ν•΄μ„ μ§€μ •ν•΄μ¤„ μ μμ§€λ§ `@GetMapping` μ—λ…Έν…μ΄μ…μ„ ν†µν•΄μ„λ„ μ§€μ •ν•  μ μλ‹¤.

```java
@GetMapping("/mapping/{userId}")
public String mappingPath(@PathVariable String data) {
    log.info("mappingPath userId = {}", data); // {} λ΅ ν•΄μ•Όν•¨.
    return "ok";
}
```

μμ£Ό μ“°μ΄λ” `PathVariable` (κ²½λ΅ λ³€μ) μ„ μ‚¬μ©ν•λ©΄ μ„ μ½”λ“μ²λΌ μ“Έ μ μλ‹¤.
`{}` κ΄„νΈ μ•μ— μλ” κ°’μ€ `http://localhost:8080/mapping/userA` κ°™μ€ λ§ν¬λ΅ μ΄λ™ν• μ‹ `userA` κ°€ μλ™μΌλ΅ λ“±λ΅λλ‹¤.

```java
@GetMapping("/mapping/users/{userId}/orders/{orderId}")
public String mappingPath(@PathVariable String userId, @PathVariable Long orderId) {
    log.info("mappingPath userId = {} , orderId = {} ", userId, orderId);
    return "ok";
}
```

λν• κ²½λ΅ λ³€μλ¥Ό λ‹¤μ¤‘μΌλ΅ μ‚¬μ© κ°€λ¥ν•λ‹¤.


```java
@GetMapping(value = "/mapping-param", params = "mode=debug")
public String mappingParam() {
    log.info("mappingParam");
    return "ok";
}
```

νΉμ • νλΌλ―Έν„°κ°€ μμ–΄μ•Ό ν•λ” μ΅°κ±΄μ„ λ§λ“¤ μ μλ‹¤.
`http://localhost:8080/mapping-param?mode=debug` μ²λΌ νλΌλ―Έν„°κ°€ μ΅΄μ¬ν•΄μ•Όμ§€ λ·°λ¥Ό μ½μ„ μ μλ‹¤.

```java
@GetMapping(value = "/mapping-header", headers = "mode=debug")
public String mappingHeader() {
    log.info("mappingHeader");
    return "ok";
}
```
`header=` μ— κ°’μ„ μ…λ ¥ν•λ©΄ νΉμ • ν—¤λ”κ°€ μμ–΄μ•Όν•λ‹¤λ” μ΅°κ±΄μ„ λ§λ“¤ μ μλ‹¤.

```java

//Content-Type μ§€μ •.
@PostMapping(value = "/mapping-consume", consumes = "application/json")
public String mappingConsumes() {
    log.info("mappingConsumes");
    return "ok";
}
```

`consumes` λ¥Ό ν†µν•΄ νΉμ • `Content-Type` λ¥Ό μ§€μ •ν•  μ μλ‹¤. `application/json` μ„ λ„£μΌλ©΄ `json` ν•μ‹μ λ°μ΄ν„°λ§ μ½μ„ μ μλ‹¤.

```java
//  produces = MediaType.TEXT_HTML_VALUE
@PostMapping(value = "mapping-produce", produces = "text/html")
public String mappingProduces() {
    log.info("mappingProduces");
    return "ok";
}
```
λ§μ§€λ§‰μΌλ΅ λ―Έλ””μ–΄ νƒ€μ…λ„ μ§€μ •ν•  μ μλ‹¤. `HTTP` μ”μ²­μ `Accept` ν—¤λ”λ¥Ό κΈ°λ°μΌλ΅ λ§¤ν•‘ν•λ”λ° λ§μ•½ λ§μ§€ μ•μΌλ©΄ `406` μƒνƒ μ½”λ“λ¥Ό λ°ν™ν•λ‹¤.

> #### π“ μ”μ²­ λ§¤ν•‘ - API 

νμ›κ΄€λ¦¬λ¥Ό `HTTP API` λ΅ λ§λ“ λ‹¤κ³  κ°€μ •ν•΄λ³΄κ³  λ§¤ν•‘μ„ μ–΄λ–»κ² ν•΄λ³΄λ”μ§€ μ§μ ‘ μ½”λ“λ¥Ό λ§λ“¤μ–΄ λ³΄μ.

μ‹¤μ  λ°μ΄ν„°λ” μ €μ¥ν•μ§€ μ•λ”λ‹¤.

* νμ› λ©λ΅ μ΅°ν: `GET /users`
* νμ› λ“±λ΅: `POST /users`
* νμ› μ΅°ν: `GET /users/{userId}`
* νμ› μμ •: `PATCH /users/{userId}`
* νμ› μ‚­μ : `DELETE /users/{userId}`


```java
package hello.springmvc.basic.requestmapping;

@RestController
@RequestMapping("/mapping/users")
public class MappingClassController {

    @GetMapping
    public String user() {
        return "get users";
    }

    @PostMapping
    public String addUser() {
        return "post user";
    }

    @GetMapping("/{userId}")
    public String findUser(@PathVariable String userId) {
        return "get userId = " + userId;
    }

    @PatchMapping("/{userId}")
    public String updateUser(@PathVariable String userId) {
        return "update userId = " + userId;
    }

    @DeleteMapping("/{userId}")
    public String deleteUser(@PathVariable String userId) {
        return "delete userId = " + userId;
    }
}
```

`@RequestMapping` μ„ ν΄λμ¤ μƒλ‹¨μ— μ μ–΄λ‘λ©΄ κ²½λ΅μ μ¤‘λ³µμ„ μ κ±°ν•  μ μλ‹¤.
`@PathVariable` μ„ ν†µν•΄ νλΌλ―Έν„°λ¥Ό κ°€μ Έμ¬ μ μκ³  `@PostMapping , @PatchMapping , @DeleteMapping , @GetMapping` λ“±μ„ μ‚¬μ©ν•  μ μλ‹¤.

> #### π“ HTTP μ”μ²­ - κΈ°λ³Έ, ν—¤λ” μ΅°ν

μ΄λ²μ—λ” `HTTP` ν—¤λ” μ •λ³΄λ¥Ό μ΅°νν•λ” λ²•μ„ μ•μ•„λ³΄μ.

```java
package hello.springmvc.basic.request;

@Slf4j
@RestController
public class RequestHeaderController {


    @RequestMapping("/headers")
    public String headers(HttpServletRequest request, HttpServletResponse response,
        HttpMethod httpMethod, Locale locale,
        @RequestHeader MultiValueMap<String, String> headerMap, @RequestHeader("host") String host,
        @CookieValue(value = "myCookie", required = false) String cookie) {

        log.info("request={}", request);
        log.info("response={}", response);
        log.info("httpMethod={}", httpMethod);
        log.info("locale={}", locale);
        log.info("headerMap={}", headerMap);
        log.info("header host={}", host);
        log.info("myCookie={}", cookie);
        return "ok";
    }
}
```
ν—¤λ” μ •λ³΄λ¥Ό μ΅°νν• λ• λ§μ€ νλΌλ―Έν„°λ¥Ό μ‚¬μ©ν•  μ μλ‹¤.
`@RequestHeader MultiValueMap` μ€ `?age=20&age=10` κ°™μ΄ ν•λ‚μ ν‚¤μ— μ—¬λ¬ κ°’μ„ λ°›μ„ μ μλ‹¤.

`@RequestHeader("host") String host` μ€ νΉμ • `HTTP` ν—¤λ”λ¥Ό μ΅°ν ν•  μ μλ‹¤.

> #### π“ HTTP μ”μ²­ νλΌλ―Έν„° - μΏΌλ¦¬ νλΌλ―Έν„°, HTML Form

```java
package hello.springmvc.basic.request;

@Slf4j
@Controller
public class RequestParamController {

    @RequestMapping("/request-param-v1")
    public void requestParamV1(HttpServletRequest request, HttpServletResponse response)
        throws IOException {
        String username = request.getParameter("username");
        int age = Integer.parseInt(request.getParameter("age"));

        log.info("username = {} , age = {} ", username, age);
        response.getWriter().write("OK");
    }
```

κΈ°λ³Έμ μΈ μ„λΈ”λ¦Ώ νλΌλ―Έν„°λ¥Ό μ‚¬μ©ν•λ©΄ μ„μ²λΌ μ‚¬μ©ν•  μ μλ‹¤.

```java
@ResponseBody // RestController μ™€ λ™μΌν• κΈ°λ¥
@RequestMapping("request-param-v2")
public String requestParamV2(
    @RequestParam("username") String memberName,
    @RequestParam("age") int memberAge
) {
    log.info("username = {} , age = {} ", memberName, memberAge);
    return "ok";
}
```

λ‹¤μμΌλ΅ `@RequestParam` μ—λ…Έν…μ΄μ…μ„ ν†µν•΄ νΉμ • νλΌλ―Έν„° κ°’μ„ λ°›μ•„ μ¬ μ μλ‹¤.
λν• `@ResponseBody` λ¥Ό μ‚¬μ©μ‹ `@RestController` μ™€ λ™μΌν• κΈ°λ¥μ„ μν–‰ν•λ‹¤.

```java
@RequestParam String username, @RequestParam int age
```
μ΄λ• `HTTP` νλΌλ―Έν„° μ΄λ¦„μ΄ λ³€μ μ΄λ¦„κ³Ό κ°™λ‹¤λ©΄ μ„ μ²λΌ μƒλµν•  μ μλ‹¤.

```java
String username, int age
```
λν• `String , int , Integer` κ°™μ΄ κ°μ²΄κ°€ μ•„λ‹λΌ λ‹¨μ νƒ€μ…μ΄λ©΄ `@RequestParam` μ—λ…Έν…μ΄μ…λ„ μƒλµν•  μ μλ‹¤.

ν•μ§€λ§ μ—λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•μ§€ μ•μΌλ©΄ μ½”λ“κ°€ λ…ν™•ν•μ§€ μ•λ‹¤λ” λ‹¨μ λ„ μλ‹¤.

```java
@RequestParam(required = true, defaultValue = "guest") String username
@RequestParam(required = false, defaultValue = "-1") Integer age
```

`@RequestParam` μ—μ„ `required` μµμ…μ„ ν†µν•΄ νλΌλ―Έν„° ν•„μ μ—¬λ¶€λ¥Ό κ²°μ •ν•  μ μλ‹¤. λ§μ•½ `false` λ©΄ ν•΄λ‹Ή νλΌλ―Έν„°κ°€ μ—†μ–΄λ„ μ½”λ“κ°€ μ‹¤ν–‰λλ‹¤.

`defaultValue` μµμ…μ„ ν†µν•΄ κΈ°λ³Έκ°’μ„ μ μ©μ‹ν‚¬ μ μλ‹¤. `required=false` μΌλ•λ§ μλ―Έκ°€ μλ‹¤.

`?username=` μ²λΌ `""` λΉλ¬Έμμ κ²½μ°μ—λ„ μ μ©μ΄ λλ‹¤.

```java
@ResponseBody
@RequestMapping("request-param-map")
public String requestParamMap(@RequestParam Map<String, Objects> paramMap) {
    log.info("username = {} , age = {} ", paramMap.get("username"), paramMap.get("age"));
    return "ok";
}
```

νλΌλ―Έν„°λ¥Ό `Map` μ„ ν†µν•΄μ„λ„ λ°›μ„ μ μλ‹¤. λ§μ•½ μ¤‘λ³µν‚¤κ°€ μμ„ μ μλ‹¤λ©΄ `MultiValueMap` λ„ μ‚¬μ© κ°€λ¥ν•λ‹¤.

> #### π“ HTTP μ”μ²­ νλΌλ―Έν„° - @ModelAttribute

κ°λ°μ„ ν• λ• μ”μ²­ νλΌλ―Έν„°λ¥Ό λ°›μ•„μ„ ν•„μ”ν• κ°μ²΄λ¥Ό λ§λ“¤κ³  κ·Έ κ°μ²΄μ— κ°’μ„ λ„£μ–΄μ¤μ•Ό ν•  λ•κ°€ μλ‹¤.

```java
@RequestParam String username;
@RequestParam int age;
HelloData data = new HelloData();
data.setUsername(username);
data.setAge(age);
```

μ„μ™€κ°™μ€ λ΅μ§μ„ ν•΄μ•Όν•μ§€λ§ μ¤ν”„λ§μ—μ„λ” `@ModelAttribute ` μ—λ…Έν…μ΄μ…μ„ μ κ³µν•λ‹¤.

```java
package hello.springmvc.basic;

import lombok.Data;

@Data
public class HelloData {
    private String username;
    private int age;
}
```
λ°μ΄ν„°λ¥Ό μ €μ¥ν•  ν΄λμ¤λ¥Ό μ„ μ½”λ“λ΅ λ§λ“¤μ—λ‹¤. 
`@Data` μ—λ…Έν…μ΄μ…μ€ λ΅¬λ³µμ `@Getter , @Setter , @ToString , @EqualsAndHashCode , @RequiredArgsConstructor` μ—λ…Έν…μ΄μ… κΈ°λ¥μ„ μ κ³µν•λ‹¤.

```java
@ResponseBody
@RequestMapping("/model-attribute-v1")
public String modelAttributeV1(@ModelAttribute HelloData helloData) {
    log.info("username = {} , age = {} ", helloData.getUsername(), helloData.getAge());
    return "ok";
}
```

λ”°λΌμ„ μ„ μ½”λ“μ²λΌ `@ModelAttribute` μµμ…μ„ ν†µν•΄ κ°μ²΄λ¥Ό λ¶λ¬μ¤κ³  λ™μ‹μ— νλΌλ―Έν„° κ°’μ„ ν•΄λ‹Ή κ°μ²΄μ— μ €μ¥ν•  μ μλ‹¤.

`@ModelAttribute` μ—λ…Έν…μ΄μ…μ„ μ κ±°ν•  μ μλ‹¤.

> #### π“ HTTP μ”μ²­ λ©”μ‹μ§€ - λ‹¨μ ν…μ¤νΈ

μ”μ²­ νλΌλ―Έν„°μ™€ λ‹¤λ¥΄κ² `HTTP` λ©”μ‹μ§€ λ°”λ””λ¥Ό ν†µν•΄ λ°μ΄ν„°κ°€ μ§μ ‘ μ¤λ” κ²½μ°λ” `@RequestParam , @ModelAttribute` λ¥Ό μ‚¬μ©ν•  μ μ—†λ‹¤.

```java
package hello.springmvc.basic.request;

@Slf4j
@Controller
public class RequestBodyStringController {

    @PostMapping("/request-body-string-v1")
    public void requestBodyString(HttpServletRequest request, HttpServletResponse response) throws IOException {
        ServletInputStream inputStream = request.getInputStream();
        String messageBody = StreamUtils.copyToString(inputStream, StandardCharsets.UTF_8);

        log.info("messageBody={}", messageBody);

        response.getWriter().write("ok");
    }
```
μ„λΈ”λ¦Ώλ§μ„ μ‚¬μ©ν•λ‹¤λ©΄ `request.getInputStream()` μ„ ν†µν•΄ `HTTP` λ©”μ‹μ§€ λ°”λ””λ¥Ό μ½μ–΄ μ¬ μ μλ‹¤.

```java
InputStream inputStream , Writer responseWriter
```
λ§μ•½ `response , request` λ¥Ό μ‚¬μ©ν•μ§€ μ•λ”λ‹¤λ©΄ νλΌλ―Έν„°λ¥Ό μ„μ²λΌ λ³€κ²½ν•  μ μλ‹¤.

```java
@PostMapping("/request-body-string-v3")
public HttpEntity<String> requestBodyStringV3(HttpEntity<String> httpEntity) throws IOException {

    String messageBody = httpEntity.getBody();
    log.info("messageBody={}", messageBody);

    return new HttpEntity<>("ok");
}
```
`HttpEntity` κ°μ²΄λ¥Ό μ‚¬μ©ν•  μ μλ‹¤. μ‘λ‹µμ—λ„ μ‚¬μ©κ°€λ¥ν•κ³  `Htpp` λ©”μ‹μ§€ μ»¨λ²„ν„° κΈ°λ¥μ„ μ‚¬μ©ν•λ‹¤.

```java
@PostMapping("/request-body-string-v4")
@ResponseBody
public String requestBodyStringV4(@RequestBody String messageBody) throws IOException {

    log.info("messageBody={}", messageBody);

    return "ok";
}
```
`@RequestBody` μ—λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•λ©΄ μ•„μ£Ό νΈλ¦¬ν•κ² `http` λ©”μ‹μ§€ λ°”λ”” μ •λ³΄λ¥Ό μ΅°νν•  μ μλ‹¤.

> #### π“ HTTP μ”μ²­ λ©”μ‹μ§€ - JSON

μ΄λ²μ—λ” `HTTP API` μ—μ„ μ£Όλ΅ μ‚¬μ©ν•λ” `json` ν•μ‹μ λ°μ΄ν„°λ¥Ό μ΅°νν•΄λ³΄μ.

```java
package hello.springmvc.basic.request;

@Slf4j
@Controller
public class RequestBodyJsonController {

    private ObjectMapper objectMapper = new ObjectMapper();

    @PostMapping("/request-body-json-v1")
    public void requestBodyJsonV1(HttpServletRequest request, HttpServletResponse response) throws IOException {

        ServletInputStream inputStream = request.getInputStream();
        String messageBody = StreamUtils.copyToString(inputStream, StandardCharsets.UTF_8);

        log.info("messageBody={}", messageBody);
        HelloData helloData = objectMapper.readValue(messageBody, HelloData.class);

        log.info("username = {} , age ={}" , helloData.getUsername() , helloData.getAge());

        response.getWriter().write("ok");
    }
}
```

κΈ°λ³Έμ— μ„λΈ”λ¦Ώλ§μ„ μ‚¬μ©ν• λ–„λ” μ„μ²λΌ `ObjectMapper` μ„ μ‚¬μ©ν–μ–΄μ•Ό ν–λ‹¤.

```java
@ResponseBody
@PostMapping("/request-body-json-v2")
public String requestBodyJsonV2(@RequestBody String messageBody) throws IOException {

    log.info("messageBody={}", messageBody);
    HelloData helloData = objectMapper.readValue(messageBody, HelloData.class);

    log.info("username = {} , age ={}", helloData.getUsername(), helloData.getAge());
    return "ok";
}
```
ν•μ§€λ§ `@RequestBody` μ—λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•λ©΄ `objectMapper` μ„ μ‚¬μ©ν•΄ `messageBody` μ— μλ” λ°μ΄ν„°λ¥Ό `helloData` μ— μ €μ¥λ§ ν•λ©΄ λλ‹¤.

```java
@ResponseBody
@PostMapping("/request-body-json-v3")
public String requestBodyJsonV3(@RequestBody HelloData helloData)  {
    log.info("username = {} , age ={}", helloData.getUsername(), helloData.getAge());
    return "ok";
}
```

νλΌλ―Έν„° μμ²΄λ¥Ό `HelloData` λ΅ μ„¤μ •ν•λ©΄ λ©”μ‹μ§€ μ»¨λ²„ν„° κΈ°λ¥μ„ ν†µν•΄ `objectMapper` κ°€ ν–λ μΌμ„ λ€μ‹  ν•΄μ¤€λ‹¤. λ‹¤λ§ `@RequestBody` μ—λ…Έν…μ΄μ…μ€ μƒλµν•  μ μ—†λ‹¤.

```java
@ResponseBody
@PostMapping("/request-body-json-v4")
public String requestBodyJsonV4(HttpEntity<HelloData> httpEntity)  {
    HelloData helloData = httpEntity.getBody();
    log.info("username = {} , age ={}", helloData.getUsername(), helloData.getAge());
    return "ok";
}
```

`HttpEntity` λ¥Ό ν†µν•΄μ„λ„ κ°€λ¥ν•λ‹¤. 

> #### π“ μ •λ¦¬

μ§€κΈκΉμ§€ μ”μ²­ λ§¤ν•‘μ„ ν•λ” λ°©λ²•μ„ μ•μ•„λ³΄μ•κ³  , `HTTP` μ”μ²­μ—μ„ ν—¤λ”λ¥Ό μ΅°νν•λ” λ²•κ³Ό μ¤ν”„λ§ μ—λ…Έν…μ΄μ…μ„ ν†µν•΄ κ°„λµν™” ν•λ”λ²• , `HTTP` λ©”μ‹μ§€ λ°”λ””λ¥Ό μ΅°νν•λ” λ°©λ²•μ¤‘ μΏΌλ¦¬νλΌλ―Έν„°μ™€ λ©”μ‹μ§€ λ°”λ”” (ν…μ¤νΈ,`json`) μ„ μ¤ν”„λ§ μ—λ…Έν…μ΄μ…μ„ ν†µν•΄ κ°„λ‹¨ν•κ² μ•μ•„λ³΄λ” λ°©λ²•μ„ μ‚΄ν΄λ³΄μ•λ‹¤.

λ‹¤μμ—λ” `HTTP` μ‘λ‹µμ—μ„ λ°μ΄ν„°λ¥Ό μ–΄λ–»κ² μ‘λ‹µν•λ”μ§€ μ•μ•„λ³΄μ.
